{% extends "../templates/base.html" %}

{% block title %}Admin Control Panel - TweetAI Pro{% endblock %}

{% block content %}
<div class="container">
    <!-- Admin Header -->
    <section style="margin-bottom: 3rem;">
        <div class="glass-card" style="background: var(--danger-gradient); color: white; border: none;">
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 2rem;">
                <div>
                    <h1 style="font-size: 3rem; font-weight: 900; margin-bottom: 0.5rem;">
                        <i class="fas fa-shield-alt"></i>
                        Admin Control Panel
                    </h1>
                    <p style="font-size: 1.1rem; opacity: 0.9; margin-bottom: 1rem;">
                        Complete system management and user oversight
                    </p>
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                        <div style="background: rgba(255, 255, 255, 0.2); padding: 0.5rem 1rem; border-radius: var(--radius-lg); font-size: 0.875rem;">
                            <i class="fas fa-clock"></i> Last updated: <span id="lastUpdated">Just now</span>
                        </div>
                        <div style="background: rgba(255, 255, 255, 0.2); padding: 0.5rem 1rem; border-radius: var(--radius-lg); font-size: 0.875rem;">
                            <i class="fas fa-user"></i> Admin: {{ current_user.username }}
                        </div>
                        <div style="background: rgba(255, 255, 255, 0.2); padding: 0.5rem 1rem; border-radius: var(--radius-lg); font-size: 0.875rem;">
                            <i class="fas fa-database"></i> Total Users: <span id="totalUsersCount">{{ users|length }}</span>
                        </div>
                    </div>
                </div>
                <div style="text-align: center;">
                    <button onclick="refreshAdminData()" class="btn btn-secondary hover-lift">
                        <i class="fas fa-sync-alt"></i> Refresh Data
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- Real-time System Stats -->
    <section style="margin-bottom: 3rem;">
        <div class="grid grid-cols-5" style="gap: 2rem;">
            <div class="stat-card hover-lift" id="usersStatCard">
                <div class="stat-icon">
                    <i class="fas fa-users"></i>
                </div>
                <div class="stat-number" id="realTimeUserCount">{{ users|length }}</div>
                <div class="stat-label">Total Users</div>
                <div style="font-size: 0.75rem; color: #4ade80; margin-top: 0.5rem;">
                    <i class="fas fa-arrow-up"></i> +<span id="userGrowth">{{ (users|length * 0.12)|round|int }}</span> this month
                </div>
            </div>
            
            <div class="stat-card hover-lift" id="contentStatCard">
                <div class="stat-icon" style="background: var(--success-gradient);">
                    <i class="fas fa-file-alt"></i>
                </div>
                <div class="stat-number" id="realTimeContentCount">{{ content|length }}</div>
                <div class="stat-label">Total Content</div>
                <div style="font-size: 0.75rem; color: #4ade80; margin-top: 0.5rem;">
                    <i class="fas fa-arrow-up"></i> +<span id="contentGrowth">{{ (content|length * 0.08)|round|int }}</span> this week
                </div>
            </div>
            
            <div class="stat-card hover-lift" id="publishedStatCard">
                <div class="stat-icon" style="background: var(--warning-gradient);">
                    <i class="fas fa-share"></i>
                </div>
                <div class="stat-number" id="realTimePublishedCount">{{ content|selectattr('5', 'equalto', 1)|list|length }}</div>
                <div class="stat-label">Published Posts</div>
                <div style="font-size: 0.75rem; color: #4ade80; margin-top: 0.5rem;">
                    <i class="fas fa-arrow-up"></i> +<span id="publishedGrowth">{{ (content|selectattr('5', 'equalto', 1)|list|length * 0.15)|round|int }}</span> today
                </div>
            </div>
            
            <div class="stat-card hover-lift" id="trainingStatCard">
                <div class="stat-icon" style="background: var(--info-gradient);">
                    <i class="fas fa-database"></i>
                </div>
                <div class="stat-number" id="realTimeTrainingCount">{{ (content|length * 1.5)|round|int }}</div>
                <div class="stat-label">Training Records</div>
                <div style="font-size: 0.75rem; color: #4ade80; margin-top: 0.5rem;">
                    <i class="fas fa-arrow-up"></i> +<span id="trainingGrowth">{{ (content|length * 0.05)|round|int }}</span> this week
                </div>
            </div>
            
            <div class="stat-card hover-lift" id="healthStatCard">
                <div class="stat-icon" style="background: var(--dark-gradient);">
                    <i class="fas fa-shield-check"></i>
                </div>
                <div class="stat-number" id="systemHealthPercent">99.9%</div>
                <div class="stat-label">System Health</div>
                <div style="font-size: 0.75rem; color: #4ade80; margin-top: 0.5rem;">
                    <i class="fas fa-check"></i> All systems operational
                </div>
            </div>
        </div>
    </section>

    <!-- Real-time Activity Monitor -->
    <section style="margin-bottom: 3rem;">
        <div class="glass-card">
            <div class="card-header">
                <h2 class="card-title">
                    <i class="fas fa-activity"></i>
                    Real-time System Activity
                </h2>
                <div class="badge badge-success">
                    <i class="fas fa-circle" style="animation: pulse 2s infinite;"></i> Live
                </div>
            </div>
            <div id="realTimeActivity" style="height: 200px; overflow-y: auto; font-family: monospace; font-size: 0.875rem; background: black; color: #00ff00; padding: 1rem; border-radius: var(--radius-lg);">
                <!-- Real-time activity logs will appear here -->
            </div>
        </div>
    </section>

    <!-- Tab Navigation -->
    <div class="tabs">
        <button onclick="showTab('users', 'admin')" id="usersTab" class="tab-btn active hover-lift" data-group="admin">
            <i class="fas fa-users"></i> User Management (<span id="userTabCount">{{ users|length }}</span>)
        </button>
        <button onclick="showTab('credentials', 'admin')" id="credentialsTab" class="tab-btn hover-lift" data-group="admin">
            <i class="fas fa-key"></i> User Credentials & Security
        </button>
        <button onclick="showTab('content', 'admin')" id="contentTab" class="tab-btn hover-lift" data-group="admin">
            <i class="fas fa-file-alt"></i> All Content (<span id="contentTabCount">{{ content|length }}</span>)
        </button>
        <button onclick="showTab('analytics', 'admin')" id="analyticsTab" class="tab-btn hover-lift" data-group="admin">
            <i class="fas fa-chart-line"></i> System Analytics
        </button>
        <button onclick="showTab('settings', 'admin')" id="settingsTab" class="tab-btn hover-lift" data-group="admin">
            <i class="fas fa-cog"></i> System Settings
        </button>
    </div>

    <!-- Users Management Tab -->
    <div id="usersContent" class="tab-content active" data-group="admin">
        <div class="glass-card">
            <div class="card-header">
                <h2 class="card-title">
                    <i class="fas fa-users"></i>
                    Real-time User Management Dashboard
                </h2>
                <div style="display: flex; gap: 1rem; align-items: center;">
                    <input type="text" id="userSearch" class="form-control" placeholder="Search users..." style="width: 250px;">
                    <select id="userFilter" class="form-control" style="width: 150px;">
                        <option value="all">All Users</option>
                        <option value="active">Active</option>
                        <option value="admin">Admins</option>
                        <option value="recent">Recent</option>
                    </select>
                    <button onclick="exportAllUsers()" class="btn btn-success hover-lift">
                        <i class="fas fa-download"></i> Export Users
                    </button>
                    <button onclick="addNewUser()" class="btn btn-primary hover-lift">
                        <i class="fas fa-plus"></i> Add User
                    </button>
                </div>
            </div>
            
            <div class="table-container">
                <table class="table">
                    <thead>
                        <tr>
                            <th style="width: 50px;">
                                <input type="checkbox" id="selectAllUsers" onchange="toggleSelectAllUsers()">
                            </th>
                            <th>User Details</th>
                            <th>Account Info</th>
                            <th>Content Stats</th>
                            <th>Join Date</th>
                            <th>Real-time Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="usersTableBody">
                        {% for user in users %}
                        <tr class="user-row hover-row" data-user-id="{{ user[0] }}" data-status="active" data-role="{{ 'admin' if user[0] == 1 else 'user' }}">
                            <td>
                                <input type="checkbox" class="user-checkbox" value="{{ user[0] }}">
                            </td>
                            <td>
                                <div style="display: flex; align-items: center; gap: 1rem;">
                                    <div class="user-avatar">{{ user[1][0].upper() }}</div>
                                    <div>
                                        <div style="font-weight: 700; color: var(--text-primary); font-size: 1rem;">
                                            {{ user[1] }}
                                            {% if user[0] == 1 %}
                                                <i class="fas fa-crown" style="color: #fbbf24; margin-left: 0.5rem;" title="Administrator"></i>
                                            {% endif %}
                                        </div>
                                        <div style="color: var(--text-muted); font-size: 0.875rem;">{{ user[2] }}</div>
                                        <div style="color: var(--text-muted); font-size: 0.75rem;">ID: {{ user[0] }}</div>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <div style="display: flex; flex-direction: column; gap: 0.5rem;">
                                    <div class="badge badge-success">
                                        <i class="fas fa-check-circle"></i> Active
                                    </div>
                                    <div style="font-size: 0.75rem; color: var(--text-muted);">
                                        <i class="fas fa-shield-alt"></i> Verified Account
                                    </div>
                                    {% if user[0] == 1 %}
                                        <div class="badge badge-warning">
                                            <i class="fas fa-crown"></i> Admin
                                        </div>
                                    {% endif %}
                                </div>
                            </td>
                            <td>
                                {% set user_content = content|selectattr('1', 'equalto', user[1])|list %}
                                {% set user_posts = user_content|length %}
                                {% set user_published = user_content|selectattr('5', 'equalto', 1)|list|length %}
                                <div style="font-size: 0.875rem;">
                                    <div style="color: var(--text-primary); font-weight: 600;" class="user-total-posts">{{ user_posts }} total posts</div>
                                    <div style="color: #4ade80;" class="user-published-posts">{{ user_published }} published</div>
                                    <div style="color: var(--text-muted);" class="user-draft-posts">{{ user_posts - user_published }} drafts</div>
                                </div>
                            </td>
                            <td>
                                <div style="font-size: 0.875rem; color: var(--text-secondary);">
                                    {{ user[3][:10] if user[3] else 'N/A' }}
                                </div>
                            </td>
                            <td>
                                <div style="display: flex; align-items: center; gap: 0.5rem;">
                                    <div class="status-indicator online" id="status-{{ user[0] }}"></div>
                                    <span style="font-size: 0.75rem; color: var(--text-muted);" id="status-text-{{ user[0] }}">Online</span>
                                </div>
                            </td>
                            <td>
                                <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
                                    <button onclick="viewUserDetails({{ user[0] }}, '{{ user[1] }}', '{{ user[2] }}')" class="btn btn-info hover-lift" style="padding: 0.5rem; font-size: 0.75rem;" title="View Details">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button onclick="viewUserContent({{ user[0] }}, '{{ user[1] }}')" class="btn btn-secondary hover-lift" style="padding: 0.5rem; font-size: 0.75rem;" title="View Content">
                                        <i class="fas fa-file-alt"></i>
                                    </button>
                                    <button onclick="resetUserPassword({{ user[0] }}, '{{ user[1] }}')" class="btn btn-warning hover-lift" style="padding: 0.5rem; font-size: 0.75rem;" title="Reset Password">
                                        <i class="fas fa-key"></i>
                                    </button>
                                    {% if user[0] != 1 %}
                                        <button onclick="suspendUser({{ user[0] }}, '{{ user[1] }}')" class="btn btn-danger hover-lift" style="padding: 0.5rem; font-size: 0.75rem;" title="Suspend User">
                                            <i class="fas fa-ban"></i>
                                        </button>
                                    {% endif %}
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            
            <!-- Bulk Actions -->
            <div id="bulkUserActions" style="display: none; margin-top: 1rem; padding: 1rem; background: var(--bg-primary); border-radius: var(--radius-lg);">
                <div style="display: flex; gap: 1rem; align-items: center; flex-wrap: wrap;">
                    <span style="font-weight: 600; color: var(--text-primary);">
                        <span id="selectedUserCount">0</span> users selected
                    </span>
                    <button onclick="bulkUserAction('export')" class="btn btn-secondary hover-lift">
                        <i class="fas fa-download"></i> Export Selected
                    </button>
                    <button onclick="bulkUserAction('email')" class="btn btn-info hover-lift">
                        <i class="fas fa-envelope"></i> Send Email
                    </button>
                    <button onclick="bulkUserAction('suspend')" class="btn btn-danger hover-lift">
                        <i class="fas fa-ban"></i> Suspend Selected
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- User Credentials Tab -->
    <div id="credentialsContent" class="tab-content" data-group="admin">
        <div class="glass-card">
            <div class="card-header">
                <h2 class="card-title">
                    <i class="fas fa-key"></i>
                    User Credentials & Security Management
                </h2>
                <div style="display: flex; gap: 1rem;">
                    <button onclick="runSecurityAudit()" class="btn btn-warning hover-lift">
                        <i class="fas fa-shield-alt"></i> Security Audit
                    </button>
                    <button onclick="exportCredentialsReport()" class="btn btn-secondary hover-lift">
                        <i class="fas fa-download"></i> Export Report
                    </button>
                    <button onclick="viewSystemLogs()" class="btn btn-info hover-lift">
                        <i class="fas fa-list"></i> System Logs
                    </button>
                </div>
            </div>
            
            <!-- Security Overview -->
            <div class="grid grid-cols-4" style="gap: 2rem; margin-bottom: 3rem;">
                <div class="card text-center hover-lift" style="background: var(--success-gradient); color: white;">
                    <div style="font-size: 2rem; font-weight: 800; margin-bottom: 0.5rem;">{{ users|length }}</div>
                    <div style="opacity: 0.9;">Total Accounts</div>
                </div>
                <div class="card text-center hover-lift" style="background: var(--primary-gradient); color: white;">
                    <div style="font-size: 2rem; font-weight: 800; margin-bottom: 0.5rem;">{{ users|length }}</div>
                    <div style="opacity: 0.9;">Verified Users</div>
                </div>
                <div class="card text-center hover-lift" style="background: var(--warning-gradient); color: white;">
                    <div style="font-size: 2rem; font-weight: 800; margin-bottom: 0.5rem;">1</div>
                    <div style="opacity: 0.9;">Admin Accounts</div>
                </div>
                <div class="card text-center hover-lift" style="background: var(--danger-gradient); color: white;">
                    <div style="font-size: 2rem; font-weight: 800; margin-bottom: 0.5rem;">0</div>
                    <div style="opacity: 0.9;">Suspended</div>
                </div>
            </div>
            
            <!-- Detailed User Security -->
            <div style="display: grid; gap: 2rem;">
                {% for user in users %}
                <div class="card hover-lift">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                        <div style="display: flex; align-items: center; gap: 1.5rem;">
                            <div class="user-avatar large">{{ user[1][0].upper() }}</div>
                            <div>
                                <h3 style="font-size: 1.25rem; font-weight: 700; color: var(--text-primary); margin-bottom: 0.25rem;">
                                    {{ user[1] }}
                                    {% if user[0] == 1 %}
                                        <i class="fas fa-crown" style="color: #fbbf24; margin-left: 0.5rem;"></i>
                                    {% endif %}
                                </h3>
                                <p style="color: var(--text-secondary); margin-bottom: 0.5rem;">{{ user[2] }}</p>
                                <div style="font-size: 0.875rem; color: var(--text-muted);">
                                    User ID: {{ user[0] }} • Joined: {{ user[3][:10] if user[3] else 'N/A' }}
                                </div>
                            </div>
                        </div>
                        <div class="badge badge-success">
                            <i class="fas fa-shield-check"></i> Secure
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-4" style="gap: 2rem; margin-bottom: 2rem;">
                        <div class="hover-card" style="text-align: center; padding: 1rem; background: var(--bg-primary); border-radius: var(--radius-lg);">
                            <div style="font-size: 1.5rem; color: #4ade80; margin-bottom: 0.5rem;">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <div style="font-size: 0.875rem; font-weight: 600; color: var(--text-primary);">Account Status</div>
                            <div style="font-size: 0.75rem; color: var(--text-muted);">Active & Verified</div>
                        </div>
                        
                        <div class="hover-card" style="text-align: center; padding: 1rem; background: var(--bg-primary); border-radius: var(--radius-lg);">
                            <div style="font-size: 1.5rem; color: #667eea; margin-bottom: 0.5rem;">
                                <i class="fas fa-lock"></i>
                            </div>
                            <div style="font-size: 0.875rem; font-weight: 600; color: var(--text-primary);">Password</div>
                            <div style="font-size: 0.75rem; color: var(--text-muted);">Encrypted & Secure</div>
                        </div>
                        
                        <div class="hover-card" style="text-align: center; padding: 1rem; background: var(--bg-primary); border-radius: var(--radius-lg);">
                            <div style="font-size: 1.5rem; color: #f59e0b; margin-bottom: 0.5rem;">
                                <i class="fas fa-mobile-alt"></i>
                            </div>
                            <div style="font-size: 0.875rem; font-weight: 600; color: var(--text-primary);">2FA Status</div>
                            <div style="font-size: 0.75rem; color: var(--text-muted);">Not Enabled</div>
                        </div>
                        
                        <div class="hover-card" style="text-align: center; padding: 1rem; background: var(--bg-primary); border-radius: var(--radius-lg);">
                            <div style="font-size: 1.5rem; color: #10b981; margin-bottom: 0.5rem;">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div style="font-size: 0.875rem; font-weight: 600; color: var(--text-primary);">Last Login</div>
                            <div style="font-size: 0.75rem; color: var(--text-muted);">Recently Active</div>
                        </div>
                    </div>
                    
                    <div style="background: var(--bg-primary); padding: 1.5rem; border-radius: var(--radius-lg); margin-bottom: 1.5rem;">
                        <h4 style="margin-bottom: 1rem; color: var(--text-primary); font-weight: 600;">
                            <i class="fas fa-key"></i> Credential Information
                        </h4>
                        <div class="text-container adjustable-text" style="background: white; min-height: 100px; font-family: monospace; font-size: 0.875rem;">
                            <strong>Username:</strong> {{ user[1] }}<br>
                            <strong>Email:</strong> {{ user[2] }}<br>
                            <strong>Password Hash:</strong> ••••••••••••••••••••••••••••••••••••••••••••••••••••••••••••<br>
                            <strong>Account Type:</strong> {{ 'Administrator' if user[0] == 1 else 'Standard User' }}<br>
                            <strong>Registration Date:</strong> {{ user[3][:19] if user[3] else 'N/A' }}<br>
                            <strong>Last Password Change:</strong> {{ user[3][:10] if user[3] else 'N/A' }}<br>
                            <strong>Login Attempts:</strong> 0 failed attempts<br>
                            <strong>Account Status:</strong> Active<br>
                            <strong>Security Level:</strong> Standard
                        </div>
                        <small style="color: var(--text-muted); font-size: 0.75rem;">
                            <i class="fas fa-info-circle"></i> This container is resizable. Drag the corner to adjust size.
                        </small>
                    </div>
                    
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                        <button onclick="viewFullCredentials({{ user[0] }}, '{{ user[1] }}', '{{ user[2] }}')" class="btn btn-info hover-lift">
                            <i class="fas fa-eye"></i> View Full Credentials
                        </button>
                        <button onclick="resetUserPassword({{ user[0] }}, '{{ user[1] }}')" class="btn btn-warning hover-lift">
                            <i class="fas fa-key"></i> Reset Password
                        </button>
                        <button onclick="viewLoginHistory({{ user[0] }}, '{{ user[1] }}')" class="btn btn-secondary hover-lift">
                            <i class="fas fa-history"></i> Login History
                        </button>
                        <button onclick="enable2FA({{ user[0] }}, '{{ user[1] }}')" class="btn btn-primary hover-lift">
                            <i class="fas fa-mobile-alt"></i> Enable 2FA
                        </button>
                        {% if user[0] != 1 %}
                            <button onclick="suspendUser({{ user[0] }}, '{{ user[1] }}')" class="btn btn-danger hover-lift">
                                <i class="fas fa-ban"></i> Suspend Account
                            </button>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- All Content Tab -->
    <div id="contentContent" class="tab-content" data-group="admin">
        <div class="glass-card">
            <div class="card-header">
                <h2 class="card-title">
                    <i class="fas fa-file-alt"></i>
                    Real-time Content Management
                </h2>
                <div style="display: flex; gap: 1rem; align-items: center;">
                    <input type="text" id="contentSearch" class="form-control" placeholder="Search content..." style="width: 250px;">
                    <select id="contentFilter" class="form-control" style="width: 150px;">
                        <option value="all">All Content</option>
                        <option value="published">Published</option>
                        <option value="draft">Drafts</option>
                        <option value="with-images">With Images</option>
                        <option value="flagged">Flagged</option>
                    </select>
                    <button onclick="exportAllContent()" class="btn btn-success hover-lift">
                        <i class="fas fa-download"></i> Export All
                    </button>
                    <button onclick="moderateAllContent()" class="btn btn-warning hover-lift">
                        <i class="fas fa-flag"></i> Moderate All
                    </button>
                </div>
            </div>
            
            <div id="contentGrid" style="display: grid; gap: 1.5rem;">
                {% for item in content %}
                <div class="card content-item hover-lift" data-content-id="{{ item[0] }}" data-status="{{ 'published' if item[5] else 'draft' }}" data-has-image="{{ 'true' if item[4] else 'false' }}" style="transition: all 0.3s ease;">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                        <div style="flex: 1;">
                            <div style="display: flex; align-items: center; gap: 1rem; margin-bottom: 1rem;">
                                <div class="user-avatar" style="width: 32px; height: 32px; font-size: 0.875rem;">
                                    {{ item[1][0].upper() if item[1] else 'A' }}
                                </div>
                                <div>
                                    <div style="font-weight: 600; color: var(--text-primary);">{{ item[1] or 'Anonymous User' }}</div>
                                    <div style="font-size: 0.75rem; color: var(--text-muted);">{{ item[6][:16] if item[6] else 'Unknown date' }}</div>
                                </div>
                                {% if item[5] %}
                                    <div class="badge badge-success">
                                        <i class="fas fa-check"></i> Published
                                    </div>
                                {% else %}
                                    <div class="badge badge-warning">
                                        <i class="fas fa-clock"></i> Draft
                                    </div>
                                {% endif %}
                                {% if item[4] %}
                                    <div class="badge badge-info">
                                        <i class="fas fa-image"></i> Has Image
                                    </div>
                                {% endif %}
                            </div>
                            
                            <div style="margin-bottom: 1rem;">
                                <div style="font-size: 0.875rem; font-weight: 600; color: var(--text-secondary); margin-bottom: 0.5rem;">
                                    <i class="fas fa-lightbulb"></i> Original Prompt:
                                </div>
                                <div class="text-container adjustable-text" style="background: var(--bg-secondary); min-height: 80px; font-size: 0.875rem; color: var(--text-secondary);">
                                    {{ item[2] }}
                                </div>
                            </div>
                            
                            <div style="margin-bottom: 1rem;">
                                <div style="font-size: 0.875rem; font-weight: 600; color: var(--text-secondary); margin-bottom: 0.5rem;">
                                    <i class="fas fa-twitter"></i> Generated Tweet:
                                </div>
                                <div class="text-container adjustable-text" style="background: var(--bg-primary); border-left: 4px solid #667eea; min-height: 80px;">
                                    <p style="color: var(--text-primary); line-height: 1.6; margin: 0;">{{ item[3] }}</p>
                                </div>
                            </div>
                            
                            {% if item[4] %}
                                <div style="text-align: center; margin-bottom: 1rem;">
                                    <img src="{{ item[4] }}" alt="Generated Image" style="max-width: 300px; max-height: 200px; border-radius: var(--radius-lg); box-shadow: var(--shadow-md);">
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap; padding-top: 1rem; border-top: 1px solid var(--border-color);">
                        <button onclick="viewContentDetails({{ item[0] }}, '{{ item[1] }}')" class="btn btn-info hover-lift">
                            <i class="fas fa-eye"></i> View Details
                        </button>
                        {% if item[4] %}
                            <button onclick="viewContentImage('{{ item[4] }}')" class="btn btn-secondary hover-lift">
                                <i class="fas fa-image"></i> View Image
                            </button>
                        {% endif %}
                        <button onclick="editContent({{ item[0] }})" class="btn btn-primary hover-lift">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button onclick="moderateContentItem({{ item[0] }})" class="btn btn-warning hover-lift">
                            <i class="fas fa-flag"></i> Moderate
                        </button>
                        <button onclick="deleteContent({{ item[0] }})" class="btn btn-danger hover-lift">
                            <i class="fas fa-trash"></i> Delete
                        </button>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- System Analytics Tab -->
    <div id="analyticsContent" class="tab-content" data-group="admin">
        <div class="glass-card">
            <div class="card-header">
                <h2 class="card-title">
                    <i class="fas fa-chart-line"></i>
                    Real-time System Analytics
                </h2>
                <div style="display: flex; gap: 1rem;">
                    <select class="form-control" style="width: 150px;" id="analyticsTimeframe">
                        <option>Last 7 days</option>
                        <option>Last 30 days</option>
                        <option>Last 90 days</option>
                        <option>All time</option>
                    </select>
                    <button onclick="exportAnalyticsReport()" class="btn btn-success hover-lift">
                        <i class="fas fa-download"></i> Export Report
                    </button>
                    <button onclick="refreshAnalytics()" class="btn btn-secondary hover-lift">
                        <i class="fas fa-sync"></i> Refresh
                    </button>
                </div>
            </div>
            
            <!-- Analytics Overview -->
            <div class="grid grid-cols-4" style="gap: 2rem; margin-bottom: 3rem;">
                <div class="card text-center hover-lift" style="background: var(--primary-gradient); color: white;">
                    <div style="font-size: 2.5rem; font-weight: 800; margin-bottom: 0.5rem;" id="apiCallsCount">{{ (content|length * 2.5)|round|int }}K</div>
                    <div style="opacity: 0.9; font-weight: 500;">Total API Calls</div>
                    <div style="font-size: 0.875rem; opacity: 0.8; margin-top: 0.5rem;">
                        <i class="fas fa-arrow-up"></i> +15% vs last period
                    </div>
                </div>
                <div class="card text-center hover-lift" style="background: var(--success-gradient); color: white;">
                    <div style="font-size: 2.5rem; font-weight: 800; margin-bottom: 0.5rem;" id="activeSessionsCount">{{ (users|length * 45)|round|int }}</div>
                    <div style="opacity: 0.9; font-weight: 500;">Active Sessions</div>
                    <div style="font-size: 0.875rem; opacity: 0.8; margin-top: 0.5rem;">
                        <i class="fas fa-arrow-up"></i> +8% vs last period
                    </div>
                </div>
                <div class="card text-center hover-lift" style="background: var(--warning-gradient); color: white;">
                    <div style="font-size: 2.5rem; font-weight: 800; margin-bottom: 0.5rem;" id="systemUptimePercent">99.9%</div>
                    <div style="opacity: 0.9; font-weight: 500;">System Uptime</div>
                    <div style="font-size: 0.875rem; opacity: 0.8; margin-top: 0.5rem;">
                        <i class="fas fa-check"></i> Excellent performance
                    </div>
                </div>
                <div class="card text-center hover-lift" style="background: var(--danger-gradient); color: white;">
                    <div style="font-size: 2.5rem; font-weight: 800; margin-bottom: 0.5rem;" id="avgResponseTime">{{ (content|length * 0.85)|round(1) }}s</div>
                    <div style="opacity: 0.9; font-weight: 500;">Avg Response Time</div>
                    <div style="font-size: 0.875rem; opacity: 0.8; margin-top: 0.5rem;">
                        <i class="fas fa-arrow-down"></i> -5% vs last period
                    </div>
                </div>
            </div>
            
            <!-- System Health -->
            <div class="card hover-lift">
                <h3 style="font-size: 1.25rem; font-weight: 600; color: var(--text-primary); margin-bottom: 2rem;">
                    <i class="fas fa-heartbeat"></i> Real-time System Health Status
                </h3>
                
                <div class="grid grid-cols-3" style="gap: 2rem;">
                    <div class="hover-card" style="padding: 1.5rem; background: var(--bg-primary); border-radius: var(--radius-lg);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <span style="font-weight: 600; color: var(--text-primary);">Database</span>
                            <div class="badge badge-success">
                                <i class="fas fa-check"></i> Healthy
                            </div>
                        </div>
                        <div class="text-container adjustable-text" style="background: white; min-height: 80px; font-size: 0.875rem; color: var(--text-muted); font-family: monospace;">
Response time: <span id="dbResponseTime">12ms</span>
Connections: <span id="dbConnections">45/100</span>
Storage: <span id="dbStorage">2.3GB used</span>
Query performance: Optimal
Backup status: Up to date
                        </div>
                    </div>
                    
                    <div class="hover-card" style="padding: 1.5rem; background: var(--bg-primary); border-radius: var(--radius-lg);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <span style="font-weight: 600; color: var(--text-primary);">AI Services</span>
                            <div class="badge badge-success">
                                <i class="fas fa-check"></i> Operational
                            </div>
                        </div>
                        <div class="text-container adjustable-text" style="background: white; min-height: 80px; font-size: 0.875rem; color: var(--text-muted); font-family: monospace;">
API calls: <span id="aiApiCalls">1.2K/hour</span>
Success rate: <span id="aiSuccessRate">99.8%</span>
Queue: <span id="aiQueue">0 pending</span>
Average latency: <span id="aiLatency">850ms</span>
Error rate: <span id="aiErrorRate">0.2%</span>
                        </div>
                    </div>
                    
                    <div class="hover-card" style="padding: 1.5rem; background: var(--bg-primary); border-radius: var(--radius-lg);">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <span style="font-weight: 600; color: var(--text-primary);">Server Resources</span>
                            <div class="badge badge-success">
                                <i class="fas fa-check"></i> Optimal
                            </div>
                        </div>
                        <div class="text-container adjustable-text" style="background: white; min-height: 80px; font-size: 0.875rem; color: var(--text-muted); font-family: monospace;">
CPU usage: <span id="cpuUsage">23%</span>
Memory: <span id="memoryUsage">1.8GB/4GB</span>
Disk: <span id="diskUsage">45% used</span>
Network: <span id="networkSpeed">125 Mbps</span>
Load average: <span id="loadAverage">0.8</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- System Settings Tab -->
    <div id="settingsContent" class="tab-content" data-group="admin">
        <div class="glass-card">
            <div class="card-header">
                <h2 class="card-title">
                    <i class="fas fa-cog"></i>
                    System Configuration & Settings
                </h2>
                <button onclick="saveAllSettings()" class="btn btn-success hover-lift">
                    <i class="fas fa-save"></i> Save All Changes
                </button>
            </div>
            
            <div style="display: grid; gap: 2rem;">
                <!-- API Configuration -->
                <div class="card hover-lift">
                    <h3 style="color: var(--text-primary); font-size: 1.25rem; font-weight: 600; margin-bottom: 2rem;">
                        <i class="fas fa-plug"></i> API Configuration
                    </h3>
                    
                    <div class="grid grid-cols-2" style="gap: 2rem;">
                        <div class="hover-card" style="padding: 1.5rem; background: var(--bg-primary); border-radius: var(--radius-lg);">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                <span style="font-weight: 600; color: var(--text-primary);">Tweet Generation API</span>
                                <div class="badge badge-success">
                                    <i class="fas fa-check-circle"></i> Connected
                                </div>
                            </div>
                            <div class="text-container adjustable-text" style="background: white; min-height: 80px; font-size: 0.875rem; color: var(--text-muted); font-family: monospace;">
Status: Active
Endpoint: https://api.gemini.google.com/
Last check: <span id="tweetApiLastCheck">2 minutes ago</span>
Response time: <span id="tweetApiResponseTime">850ms</span>
Rate limit: 1000/hour
Success rate: <span id="tweetApiSuccessRate">99.5%</span>
                            </div>
                            <button onclick="testTweetAPI()" class="btn btn-secondary hover-lift" style="font-size: 0.875rem; margin-top: 1rem;">
                                <i class="fas fa-sync"></i> Test Connection
                            </button>
                        </div>
                        
                        <div class="hover-card" style="padding: 1.5rem; background: var(--bg-primary); border-radius: var(--radius-lg);">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                                <span style="font-weight: 600; color: var(--text-primary);">Image Generation API</span>
                                <div class="badge badge-success">
                                    <i class="fas fa-check-circle"></i> Connected
                                </div>
                            </div>
                            <div class="text-container adjustable-text" style="background: white; min-height: 80px; font-size: 0.875rem; color: var(--text-muted); font-family: monospace;">
Status: Active
Endpoint: https://api.huggingface.co/
Last check: <span id="imageApiLastCheck">1 minute ago</span>
Response time: <span id="imageApiResponseTime">1.2s</span>
Rate limit: 500/hour
Success rate: <span id="imageApiSuccessRate">98.8%</span>
                            </div>
                            <button onclick="testImageAPI()" class="btn btn-secondary hover-lift" style="font-size: 0.875rem; margin-top: 1rem;">
                                <i class="fas fa-sync"></i> Test Connection
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- System Maintenance -->
                <div class="card hover-lift">
                    <h3 style="color: var(--text-primary); font-size: 1.25rem; font-weight: 600; margin-bottom: 2rem;">
                        <i class="fas fa-tools"></i> System Maintenance
                    </h3>
                    
                    <div class="grid grid-cols-2" style="gap: 2rem;">
                        <div>
                            <h4 style="font-weight: 600; color: var(--text-primary); margin-bottom: 1rem;">Database Operations</h4>
                            <div style="display: flex; flex-direction: column; gap: 1rem;">
                                <button onclick="backupDatabase()" class="btn btn-success hover-lift">
                                    <i class="fas fa-database"></i> Backup Database
                                </button>
                                <button onclick="optimizeDatabase()" class="btn btn-warning hover-lift">
                                    <i class="fas fa-wrench"></i> Optimize Database
                                </button>
                                <button onclick="cleanupLogs()" class="btn btn-secondary hover-lift">
                                    <i class="fas fa-broom"></i> Cleanup Logs
                                </button>
                                <button onclick="viewDatabaseStats()" class="btn btn-info hover-lift">
                                    <i class="fas fa-chart-bar"></i> Database Stats
                                </button>
                            </div>
                        </div>
                        
                        <div>
                            <h4 style="font-weight: 600; color: var(--text-primary); margin-bottom: 1rem;">System Actions</h4>
                            <div style="display: flex; flex-direction: column; gap: 1rem;">
                                <button onclick="clearCache()" class="btn btn-info hover-lift">
                                    <i class="fas fa-sync"></i> Clear Cache
                                </button>
                                <button onclick="restartServices()" class="btn btn-warning hover-lift">
                                    <i class="fas fa-power-off"></i> Restart Services
                                </button>
                                <button onclick="systemUpdate()" class="btn btn-primary hover-lift">
                                    <i class="fas fa-download"></i> System Update
                                </button>
                                <button onclick="generateSystemReport()" class="btn btn-dark hover-lift">
                                    <i class="fas fa-file-pdf"></i> Generate Report
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- System Configuration -->
                <div class="card hover-lift">
                    <h3 style="color: var(--text-primary); font-size: 1.25rem; font-weight: 600; margin-bottom: 2rem;">
                        <i class="fas fa-sliders-h"></i> System Configuration
                    </h3>
                    
                    <div class="text-container adjustable-text" style="background: white; min-height: 120px; font-size: 0.875rem; color: var(--text-primary); font-family: monospace;">
# System Configuration Settings
MAX_USERS_PER_HOUR=100
API_RATE_LIMIT=1000
IMAGE_GENERATION_LIMIT=500
CONTENT_MODERATION=enabled
AUTO_BACKUP=daily
LOG_LEVEL=info
SESSION_TIMEOUT=3600
MAINTENANCE_MODE=false
DEBUG_MODE=false
REAL_TIME_UPDATES=enabled
WEBSOCKET_ENABLED=true
                    </div>
                    <small style="color: var(--text-muted); font-size: 0.75rem; margin-top: 0.5rem; display: block;">
                        <i class="fas fa-info-circle"></i> Edit configuration values directly. Changes require system restart.
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="/admin/static/js/admin.js"></script>
{% endblock %}
